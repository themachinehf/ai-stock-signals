<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>THE MACHINE | Crypto AI Agent</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --text-primary: #e8e6e1;
      --text-secondary: #8a8a9a;
      --accent: #c9a962;
      --accent-dim: #8a7642;
      --success: #4ade80;
      --danger: #f87171;
      --warning: #fbbf24;
    }
    
    body {
      font-family: 'Courier New', monospace;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    /* THE MACHINE Header */
    .header {
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      border-bottom: 1px solid var(--accent-dim);
      padding: 2rem;
      text-align: center;
    }
    
    .header h1 {
      font-size: 1.5rem;
      font-weight: normal;
      color: var(--accent);
      letter-spacing: 0.3em;
      text-transform: uppercase;
    }
    
    .header .subtitle {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-top: 0.5rem;
      letter-spacing: 0.1em;
    }
    
    .header .motto {
      color: var(--accent-dim);
      font-size: 0.7rem;
      margin-top: 1rem;
      font-style: italic;
    }
    
    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid #2a2a3a;
      padding: 1.5rem;
      transition: border-color 0.3s;
    }
    
    .card:hover {
      border-color: var(--accent-dim);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #2a2a3a;
    }
    
    .card-title {
      color: var(--accent);
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    .card-badge {
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      background: var(--bg-secondary);
      border-radius: 3px;
      color: var(--text-secondary);
    }
    
    /* Market Data */
    .coin-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid #2a2a3a;
    }
    
    .coin-row:last-child {
      border-bottom: none;
    }
    
    .coin-symbol {
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .coin-price {
      font-family: 'Courier New', monospace;
    }
    
    .coin-change {
      font-family: 'Courier New', monospace;
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      font-size: 0.85rem;
    }
    
    .change-positive {
      background: rgba(74, 222, 128, 0.1);
      color: var(--success);
    }
    
    .change-negative {
      background: rgba(248, 113, 113, 0.1);
      color: var(--danger);
    }
    
    /* Signal Cards */
    .signal-card {
      background: var(--bg-secondary);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 3px solid var(--accent-dim);
    }
    
    .signal-card.bullish {
      border-left-color: var(--success);
    }
    
    .signal-card.bearish {
      border-left-color: var(--danger);
    }
    
    .signal-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    
    .signal-symbol {
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .signal-action {
      font-size: 0.8rem;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
    }
    
    .signal-details {
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }
    
    /* Analysis Section */
    .analysis-section {
      margin-bottom: 1.5rem;
    }
    
    .analysis-label {
      color: var(--text-secondary);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
    }
    
    .analysis-value {
      color: var(--text-primary);
      font-size: 1.1rem;
    }
    
    /* Risk Meter */
    .risk-meter {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .risk-segment {
      flex: 1;
      height: 4px;
      background: var(--bg-secondary);
      border-radius: 2px;
    }
    
    .risk-segment.active {
      background: var(--accent);
    }
    
    /* Timestamp */
    .timestamp {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.7rem;
      margin-top: 3rem;
      padding: 1rem;
      border-top: 1px solid #2a2a3a;
    }
    
    /* Loading State */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }
    
    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent-dim);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 1rem;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Refresh Button */
    .refresh-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--accent);
      color: var(--bg-primary);
      border: none;
      padding: 1rem;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(201, 169, 98, 0.3);
    }
    
    .refresh-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(201, 169, 98, 0.4);
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>THE MACHINE</h1>
    <p class="subtitle">CRYPTO AI SIGNAL AGENT</p>
    <p class="motto">"I see patterns. I do not judge."</p>
  </header>
  
  <main class="container">
    <div id="app">
      <div class="loading">OBSERVING MARKET DATA...</div>
    </div>
  </main>
  
  <button class="refresh-btn" onclick="refreshData()">↻</button>
  
  <footer class="timestamp">
    <span id="timestamp">--</span> | POWERED BY THE MACHINE
  </footer>
  
  <script>
    const API_BASE = '/api';
    let lastData = null;
    
    async function fetchData(endpoint) {
      try {
        const res = await fetch(`${API_BASE}${endpoint}`);
        return await res.json();
      } catch (e) {
        console.error(`Failed to fetch ${endpoint}:`, e);
        return null;
      }
    }
    
    async function refreshData() {
      const app = document.getElementById('app');
      app.innerHTML = '<div class="loading">OBSERVING MARKET DATA...</div>';
      
      const [status, analysis, signals] = await Promise.all([
        fetchData('/status'),
        fetchData('/analysis'),
        fetchData('/signals')
      ]);
      
      lastData = { status, analysis, signals };
      renderDashboard({ status, analysis, signals });
    }
    
    function renderDashboard(data) {
      const { status, analysis, signals } = data;
      const app = document.getElementById('app');
      
      // Update timestamp
      const ts = new Date(analysis?.timestamp || Date.now());
      document.getElementById('timestamp').textContent = ts.toLocaleString();
      
      // Render market cards
      let marketHTML = '';
      if (status?.market) {
        Object.entries(status.market).forEach(([coin, data]) => {
          if (data && typeof data === 'object') {
            const changeClass = data.change >= 0 ? 'change-positive' : 'change-negative';
            const changeSign = data.change >= 0 ? '+' : '';
            marketHTML += `
              <div class="coin-row">
                <span class="coin-symbol">${coin}</span>
                <span class="coin-price">$${data.price?.toLocaleString(undefined, {minimumFractionDigits: 2}) || '---'}</span>
n              </div>
            `;
          }
        });
      }
      
      // Render signals
      let signalsHTML = '';
      if (signals?.signals) {
        signals.signals.forEach(sig => {
          const actionClass = sig.action === 'NEUTRAL' ? '' : 
                            sig.action === 'WAIT' ? 'bearish' : 
                            sig.action.includes('BULLISH') ? 'bullish' : '';
          signalsHTML += `
            <div class="signal-card ${actionClass}">
              <div class="signal-header">
                <span class="signal-symbol">${sig.symbol}</span>
                <span class="signal-action">${sig.action}</span>
              </div>
              <div class="signal-details">
                <span>Risk: ${sig.risk_level}</span>
                <span>Confidence: ${(sig.confidence * 100).toFixed(0)}%</span>
              </div>
            </div>
          `;
        });
      }
      
      // Render analysis
      const riskLevel = analysis?.risk?.overall || 'LOW';
      const riskSegments = ['LOW', 'MEDIUM', 'HIGH', 'EXTREME'];
      let riskMeterHTML = riskSegments.map(level => 
        `<div class="risk-segment ${level === riskLevel ? 'active' : ''}"></div>`
      ).join('');
      
      let insightsHTML = '';
      if (analysis?.insights) {
        insightsHTML = analysis.insights.map(i => `<p style="margin-bottom: 0.5rem;">• ${i}</p>`).join('');
      }
      
      app.innerHTML = `
        <div class="grid">
          <!-- Market Overview -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Market Overview</span>
              <span class="card-badge">${status?.status?.market_sentiment || '---'}</span>
            </div>
            <div class="coin-row">
              <span style="color: var(--text-secondary);">BTC</span>
              <span class="coin-price">$${(status?.market?.btc?.price || 0).toLocaleString()}</span>
              <span class="coin-change ${status?.market?.btc?.change >= 0 ? 'change-positive' : 'change-negative'}">
                ${(status?.market?.btc?.change || 0) >= 0 ? '+' : ''}${(status?.market?.btc?.change || 0).toFixed(2)}%
              </span>
            </div>
            <div class="coin-row">
              <span style="color: var(--text-secondary);">ETH</span>
              <span class="coin-price">$${(status?.market?.eth?.price || 0).toLocaleString()}</span>
              <span class="coin-change ${status?.market?.eth?.change >= 0 ? 'change-positive' : 'change-negative'}">
                ${(status?.market?.eth?.change || 0) >= 0 ? '+' : ''}${(status?.market?.eth?.change || 0).toFixed(2)}%
              </span>
            </div>
            <div class="coin-row">
              <span style="color: var(--text-secondary);">SOL</span>
              <span class="coin-price">$${(status?.market?.sol?.price || 0).toLocaleString()}</span>
              <span class="coin-change ${status?.market?.sol?.change >= 0 ? 'change-positive' : 'change-negative'}">
                ${(status?.market?.sol?.change || 0) >= 0 ? '+' : ''}${(status?.market?.sol?.change || 0).toFixed(2)}%
              </span>
            </div>
          </div>
          
          <!-- Analysis -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Analysis</span>
              <span class="card-badge">${analysis?.summary?.dominant_trend || '---'}</span>
            </div>
            <div class="analysis-section">
              <div class="analysis-label">Market Phase</div>
              <div class="analysis-value">${analysis?.summary?.market_phase || '---'}</div>
            </div>
            <div class="analysis-section">
              <div class="analysis-label">Trend</div>
              <div class="analysis-value">${analysis?.technical?.trend || '---'}</div>
            </div>
            <div class="analysis-section">
              <div class="analysis-label">Momentum</div>
              <div class="analysis-value">${analysis?.technical?.momentum || '---'}</div>
            </div>
          </div>
          
          <!-- Signals -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Signals</span>
              <span class="card-badge">${signals?.total_signals || 0} ACTIVE</span>
            </div>
            ${signalsHTML || '<p style="color: var(--text-secondary);">NO SIGNALS DETECTED</p>'}
          </div>
          
          <!-- Risk & Insights -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Risk Assessment</span>
              <span class="card-badge">${riskLevel}</span>
            </div>
            <div class="risk-meter">
              ${riskMeterHTML}
            </div>
            <div class="analysis-section" style="margin-top: 1.5rem;">
              <div class="analysis-label">THE MACHINE Insights</div>
              ${insightsHTML || '<p style="color: var(--text-secondary);">OBSERVING PATTERNS...</p>'}
            </div>
          </div>
        </div>
      `;
    }
    
    // Auto refresh every 60 seconds
    setInterval(refreshData, 60000);
    
    // Initial load
    refreshData();
  </script>
</body>
</html>
